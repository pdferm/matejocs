<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Kavoon&display=swap" rel="stylesheet">


  <title>Pirámides dobles (generador)</title>
  <style>
    :root{
      --card-bg: #ffffff;
      --muted: #6b7280;
      --blue-50: #eef2ff;
      --blue-600: #1e40af;
      --box-shadow: 0 6px 20px rgba(15,23,42,0.06);
      --accent: #0ea5e9;
      --success: #059669;
      --danger: #dc2626;
    }
    body{
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: #f8fafc;
      color: #0f172a;
      margin: 24px;
      -webkit-font-smoothing:antialiased;
    }
   
    .kavoon-regular {
      font-family: "Kavoon", serif;
      font-weight: 400;
      font-style: normal;
    }



    .titulo-centrado {
      font-family: "Kavoon", system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, sans-serif;
      font-weight: 700;
      font-size: clamp(2rem, 6vw, 4rem); /* responde a pantallas pequeñas y grandes */
      line-height: 1.1;
      text-align: center;
      letter-spacing: 0.02em;
      margin: 0.75em 0 0.5em;
      /* El truco del gradiente: */
      background: linear-gradient(0deg, #ff7a18, #fac106 70%, #f8d90c);
      background-clip: text;             /* Firefox/estándar */
      -webkit-background-clip: text;     /* Chrome/Safari */
      color: transparent;                 /* Firefox */
      -webkit-text-fill-color: transparent; /* Chrome/Safari */
    } 
    
    .container{
      max-width: 1100px;
      margin: 0 auto;
    }

    .controls{
      background: var(--card-bg);
      padding: 16px;
      border-radius: 12px;
      box-shadow: var(--box-shadow);
      display: flex;
      gap: 12px;
      align-items: center;
      flex-wrap: wrap;
    }

    .controls label{ display:block; font-size:13px; color:var(--muted); margin-bottom:6px; }
    .control{
      min-width: 160px;
    }

    select, button{
      font-size: 14px;
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid #e6eef6;
      background: white;
    }

    button{
      cursor: pointer;
      background: linear-gradient(180deg,#0369a1,#0284c7);
      color: white;
      border: none;
      box-shadow: 0 6px 12px rgba(3,105,161,0.12);
    }
    button.secondary{
      background: transparent;
      color: #0f172a;
      border: 1px solid #e6eef6;
      box-shadow: none;
    }

    .layout{
      margin-top: 18px;
      display: grid;
      grid-template-columns: 1fr 1fr 1fr; /* left pyramid, center empty, right pyramid */
      gap: 18px;
      align-items: start;
    }

    .empty-center{
      background: transparent;
    }

    .pyramid-card{
      background: var(--card-bg);
      border-radius: 12px;
      padding: 18px;
      box-shadow: var(--box-shadow);
      min-height: 260px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
    }

    .title{
      font-weight: 600;
      margin-bottom: 10px;
      font-size: 15px;
    }

    .pyramid{
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
    }

    .level{
      display:flex;
      gap:10px;
      justify-content: center;
      align-items: center;
    }

    .cell{
      width:56px; height:56px;
      display:flex; align-items:center; justify-content:center;
      border-radius:10px;
      border:1px solid #e6eef6;
      background:#fbfdff;
      font-weight:600;
      font-size:16px;
      color: #0f172a;
      box-shadow: 0 3px 8px rgba(12,15,20,0.04);
    }

    .cell.known{
      background: var(--blue-50);
      color: var(--blue-600);
      border-color: rgba(30,64,175,0.15);
    }

    .cell.hidden{
      background: #f1f5f9;
      color: #94a3b8;
      font-weight:700;
    }

    .cell.revealed{
      background: #fff;
      color: #0f172a;
    }

    .controls-footer{
      margin-top: 12px;
      display:flex;
      gap:8px;
      justify-content:flex-end;
      align-items:center;
    }

    .note{
      font-size:13px;
      color:var(--muted);
      margin-top:10px;
      text-align:center;
    }
    
    .footer { margin-top:18px; display:flex; justify-content:space-between; font-size:.85rem; color:var(--muted); }
    
    /* responsive */
    @media (max-width: 900px){
      .layout{ grid-template-columns: 1fr; }
      .empty-center{ display:none; }
      .pyramid-card{ min-height: 220px; }
    }
  </style>
</head>
<body>
  <h1 class="titulo-centrado">Piràmides Numèriques</h1>
  <div class="container">
    <div class="controls" role="region" aria-label="Controles">
      <div class="control">
        <label for="order">Ordre</label>
        <select id="order">
          <option value="3">3</option>
          <option value="4">4</option>
        </select>
      </div>

      <div class="control">
        <label for="mode">Mode</label>
        <select id="mode">
          <option value="random">Aleatori</option>
          <option value="base">Números base</option>
        </select>
      </div>

      <div class="control">
        <label for="neg">Negatius</label>
        <select id="neg">
          <option value="false">No</option>
          <option value="true">Sí</option>
        </select>
      </div>

      <div class="control">
        <label for="range">Rang</label>
        <select id="range">
          <option value="10">0–10</option>
          <option value="50">0–50</option>
          <option value="100">0–100</option>
        </select>
      </div>

      <div style="margin-left:auto; display:flex; gap:8px; align-items:center;">
        <button id="generate">Generar</button>
        <button id="reveal" class="secondary">Mostrar solució</button>
      </div>
    </div>

    <div class="layout" style="margin-top:18px;">
      <div class="pyramid-card" id="left-card">
        <div class="title">Pirámide A</div>
        <div class="pyramid" id="pyramid-left"></div>
      </div>

      <div class="empty-center"></div>

      <div class="pyramid-card" id="right-card">
        <div class="title">Pirámide B</div>
        <div class="pyramid" id="pyramid-right"></div>
      </div>
    </div>

    <div class="footer">
      <span>Fet amb ❤ per a practicar càlcul mental.</span>
      <span>(c) Raquel & Javi, 2025</span>
    </div>
  </div>

  <script>
    // Listado de combinaciones válidas (oculto al usuario visualmente pero usado aquí)
    const validCombinations = {
      3: [
        ['x','y','z'],
        ['x','y','b'],
        ['x','a','b'],
        ['x','a','c'],
        ['y','b','c'],
        ['x','z','b']
      ],
      4: [
        ['x1','x2','x3','x4'],
        ['x1','x2','x3','b2'],
        ['x1','x2','x4','b1'],
        ['x1','a1','a2','a3'],
        ['x2','a1','b1','c'],
        ['x2','x3','b1','c'],
        ['x1','x3','x4','c']
      ]
    };

    // Mapas de posiciones para render (nivel -> ids)
    const mapPositions = {
      3: [['c'], ['a','b'], ['x','y','z']],
      4: [['c'], ['b1','b2'], ['a1','a2','a3'], ['x1','x2','x3','x4']]
    };

    function randInt(min,max){
      return Math.floor(Math.random()*(max-min+1))+min;
    }

    function generateBase(order, range, allowNegatives){
      const min = allowNegatives ? -range : 0;
      const max = range;
      const base = [];
      for(let i=0;i<order;i++){
        base.push(randInt(min,max));
      }
      return base;
    }

    function buildPyramidFromBase(order, base){
      const levels = [base.slice()]; // bottom
      while(levels[0].length > 1){
        const prev = levels[0];
        const next = [];
        for(let i=0;i<prev.length-1;i++) next.push(prev[i]+prev[i+1]);
        levels.unshift(next);
      }
      return levels; // top -> bottom
    }

    // Render a single pyramid into container; knownPositions is array of ids to show
    function renderPyramid(container, levels, knownPositions, showSolution){
      container.innerHTML = '';
      const order = levels[levels.length-1].length;
      const map = mapPositions[order];

      // levels is top->bottom; map is top->bottom
      for(let lvl=0; lvl<levels.length; lvl++){
        const row = document.createElement('div');
        row.className = 'level';
        // center alignment: adjust left margin depending on level width
        // but CSS centers for us
        for(let j=0;j<levels[lvl].length;j++){
          const posId = map[lvl][j];
          const val = levels[lvl][j];
          const cell = document.createElement('div');
          cell.className = 'cell';
          // decide whether to show
          const isKnown = knownPositions.includes(posId);
          if(isKnown){
            cell.classList.add('known');
            cell.textContent = val;
          } else if(showSolution){
            cell.classList.add('revealed');
            cell.textContent = val;
          } else {
            cell.classList.add('hidden');
            cell.textContent = ' ';
          }
          row.appendChild(cell);
        }
        container.appendChild(row);
      }
    }

    // UI elements
    const generateBtn = document.getElementById('generate');
    const revealBtn = document.getElementById('reveal');
    const leftContainer = document.getElementById('pyramid-left');
    const rightContainer = document.getElementById('pyramid-right');
    const orderSel = document.getElementById('order');
    const modeSel = document.getElementById('mode');
    const negSel = document.getElementById('neg');
    const rangeSel = document.getElementById('range');

    // State for current knownPositions and pyramids
    let currentKnown = [];
    let currentLeftLevels = [];
    let currentRightLevels = [];
    let currentShowSolution = false;

    function generateBoth(){
      const order = parseInt(orderSel.value,10);
      const mode = modeSel.value;
      const allowNeg = negSel.value === 'true';
      const range = parseInt(rangeSel.value,10);

      // choose the same selection (known positions) for both pyramids
      let combo;
      if(mode === 'base'){
        combo = (order === 3) ? ['x','y','z'] : ['x1','x2','x3','x4'];
      } else {
        const pool = validCombinations[order];
        combo = pool[randInt(0,pool.length-1)];
      }
      currentKnown = combo.slice(); // copy

      // generate two independent bases & pyramids
      const baseLeft = generateBase(order, range, allowNeg);
      const baseRight = generateBase(order, range, allowNeg);
      currentLeftLevels = buildPyramidFromBase(order, baseLeft);
      currentRightLevels = buildPyramidFromBase(order, baseRight);

      currentShowSolution = false;
      // render both
      renderPyramid(leftContainer, currentLeftLevels, currentKnown, currentShowSolution);
      renderPyramid(rightContainer, currentRightLevels, currentKnown, currentShowSolution);
    }

    function revealBoth(){
      if(!currentLeftLevels.length) return;
      currentShowSolution = true;
      renderPyramid(leftContainer, currentLeftLevels, currentKnown, currentShowSolution);
      renderPyramid(rightContainer, currentRightLevels, currentKnown, currentShowSolution);
    }

    // attach events
    generateBtn.addEventListener('click', generateBoth);
    revealBtn.addEventListener('click', revealBoth);

    // initial generate on load
    generateBoth();
  </script>
</body>
</html>
